<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é»˜æ ¼å°å±åŠ©æ‰‹</title>
  <!-- å¼•å…¥Tailwind CSS + é™çº§å¤„ç† -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // æ£€æµ‹Tailwindæ˜¯å¦åŠ è½½æˆåŠŸï¼Œå¤±è´¥åˆ™åŠ è½½å¤‡ç”¨æ ·å¼
    if (!window.tailwind) {
      document.write(`
        <style>
          * {margin:0;padding:0;box-sizing:border-box;}
          body {font-family:Arial, sans-serif;background:#F8FAFC;min-height:100vh;display:flex;flex-direction:column;}
          .container {width:95%;max-width:1200px;margin:0 auto;padding:0 15px;}
          .bg-white {background:white;}
          .rounded-xl {border-radius:12px;}
          .p-6 {padding:1.5rem;}
          .p-8 {padding:2rem;}
          .mb-6 {margin-bottom:1.5rem;}
          .mb-8 {margin-bottom:2rem;}
          .shadow-soft {box-shadow:0 4px 20px rgba(0,0,0,0.08);}
          .hover\\:shadow-lg:hover {box-shadow:0 10px 25px rgba(0,0,0,0.1);}
          .transition-all-300 {transition:all 300ms ease-in-out;}
          button {cursor:pointer;border:none;padding:10px 20px;border-radius:8px;}
          .bg-primary {background:#3B82F6;color:white;}
          .bg-accent {background:#F43F5E;color:white;}
          .hover\\:bg-primary\\/90:hover {background:rgba(59,130,246,0.9);}
          .hover\\:bg-accent\\/90:hover {background:rgba(244,63,94,0.9);}
          textarea, input[type="range"], select {width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;}
          textarea {height:120px;resize:none;}
          .hidden {display:none;}
          .grid {display:grid;gap:2rem;}
          @media (min-width:768px) {.grid-cols-1\\/lg\\:grid-cols-2 {grid-template-columns:1fr 1fr;}}
          .text-center {text-align:center;}
          .py-8 {padding-top:2rem;padding-bottom:2rem;}
          .py-12 {padding-top:3rem;padding-bottom:3rem;}
          .flex {display:flex;}
          .flex-col {flex-direction:column;}
          .items-center {align-items:center;}
          .justify-center {justify-content:center;}
          .flex-grow {flex-grow:1;}
          .text-xl {font-size:1.5rem;}
          .text-dark {color:#1E293B;}
          .text-secondary {color:#64748B;}
          .text-primary {color:#3B82F6;}
          .font-semibold {font-weight:600;}
          .gap-4 {gap:1rem;}
          .flex-wrap {flex-wrap:wrap;}
          .cursor-pointer {cursor:pointer;}
          .opacity-50 {opacity:0.5;}
          .cursor-not-allowed {cursor:not-allowed;}
          .border-primary {border-color:#3B82F6;}
          .section-divider {border-top:1px dashed #e2e8f0;margin:1.5rem 0;padding-top:1.5rem;}
          footer {background:#1E293B;color:white;padding:2rem 0;text-align:center;}
        </style>
      `);
    }
  </script>
  <!-- å¼•å…¥Font Awesome + å›¾æ ‡é™çº§ -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- é…ç½®Tailwindè‡ªå®šä¹‰ä¸»é¢˜ -->
  <script>
    if (window.tailwind) {
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#3B82F6',
              secondary: '#64748B',
              accent: '#F43F5E',
              dark: '#1E293B',
            },
            fontFamily: {
              arial: ['Arial', 'sans-serif'],
              heiti: ['Microsoft YaHei', 'Heiti SC', 'é»‘ä½“', 'sans-serif'],
              sourceHan: ['Source Han Sans CN', 'æ€æºé»‘ä½“', 'sans-serif'],
            },
          },
        }
      }
    }
  </script>
  
  <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .shadow-soft {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }
      .transition-all-300 {
        transition: all 300ms ease-in-out;
      }
      .section-divider {
        border-top: 1px dashed #e2e8f0;
      }
    }
  </style>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #F8FAFC;
    }
    
    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
    
    /* å›¾ç‰‡é¢„è§ˆå®¹å™¨ */
    .preview-container {
      position: relative;
      width: 100%;
      max-width: 152px;
      margin: 0 auto;
    }
    
    .image-placeholder {
      width: 100%;
      padding-top: 194.74%; /* 296/152 ç«–å±æ¯”ä¾‹ */
      background-color: #ffffff;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .image-placeholder:hover {
      border-color: #3B82F6;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }
    
    #canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      /* å…³é”®ï¼šç¦ç”¨Canvasé»˜è®¤å¹³æ»‘ï¼Œä¿æŒåƒç´ é”åˆ© */
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    
    /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
    @media (max-width: 768px) {
      .cursor-pointer {
        touch-action: manipulation;
      }
      button {
        padding: 12px 24px;
      }
      textarea, input, select {
        font-size: 16px;
      }
    }
    
    /* å…¼å®¹æ€§æç¤º */
    .compatibility-alert {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #F43F5E;
      color: white;
      padding: 10px;
      text-align: center;
      z-index: 9999;
    }
    
    /* é€‰é¡¹ç»„æ ‡é¢˜æ ·å¼ */
    .option-group-title {
      font-size: 0.9rem;
      color: #64748B;
      margin-bottom: 0.75rem;
      font-weight: 500;
    }
    
    /* å¯¹é½æ–¹å¼æŒ‰é’®æ ·å¼ä¼˜åŒ– */
    .align-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
    }
    
    /* æ”¾å¤§é¢„è§ˆæ¨¡æ€æ¡† - å¾®ä¿¡å‹å¥½å‹ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      position: relative;
      width: 90%;
      max-width: 304px; /* åŸå°ºå¯¸çš„2å€ï¼Œä¿è¯æ¸…æ™°åˆä¸è¶…å± */
      max-height: 90vh;
      display: flex;
      align-items: center;
      justify-content: center;
      transform: scale(0.9);
      transition: all 0.3s ease;
    }
    
    .modal-overlay.active .modal-content {
      transform: scale(1);
    }
    
    .modal-image {
      width: 100%;
      height: auto;
      border-radius: 8px;
      /* ç¡®ä¿å›¾ç‰‡åœ¨å¾®ä¿¡ä¸­å¯é•¿æŒ‰ä¿å­˜ */
      pointer-events: auto;
      -webkit-touch-callout: default;
      -webkit-user-select: auto;
      user-select: auto;
    }
    
    .close-modal {
      position: absolute;
      top: -40px;
      right: 0;
      color: white;
      background: transparent;
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 5px 10px;
      z-index: 10;
    }
    
    /* å¾®ä¿¡ä¿å­˜æç¤º */
    .wechat-tip {
      position: absolute;
      bottom: -50px;
      left: 0;
      right: 0;
      color: white;
      text-align: center;
      font-size: 14px;
      padding: 5px 0;
    }
    
    /* é¢„è§ˆå›¾æç¤ºæ–‡å­— */
    .preview-tooltip {
      position: absolute;
      bottom: -30px;
      left: 50%;
      transform: translateX(-50%);
      color: #64748B;
      font-size: 12px;
      text-align: center;
      white-space: nowrap;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- å…¼å®¹æ€§æç¤º -->
  <div id="compatibility-alert" class="compatibility-alert hidden">
    æ‚¨çš„æµè§ˆå™¨ç‰ˆæœ¬è¿‡æ—§ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œè¯·å‡çº§æµè§ˆå™¨æˆ–ä½¿ç”¨Chromeã€Edgeç­‰ç°ä»£æµè§ˆå™¨ï¼
  </div>

  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="bg-white shadow-sm py-4 px-6">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-[clamp(1.25rem,3vw,1.75rem)] font-bold text-primary">
        é»˜æ ¼å°å±åŠ©æ‰‹
      </h1>
      <!-- ç§»é™¤å³ä¸Šè§’ä½¿ç”¨å¸®åŠ©å’Œæºç é“¾æ¥ -->
    </div>
  </header>

  <!-- ä¸»å†…å®¹åŒº -->
  <main class="flex-grow container mx-auto px-4 py-8 md:py-12">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12">
      <!-- å·¦ä¾§ï¼šè¾“å…¥è®¾ç½®åŒº -->
      <div class="bg-white rounded-xl shadow-soft p-6 md:p-8 transform hover:shadow-lg transition-all-300">
        <h2 class="text-xl md:text-2xl font-semibold text-dark mb-6">
          æ–‡å­—è®¾ç½®
        </h2>
        
        <!-- æ ‡é¢˜éƒ¨åˆ†è®¾ç½® -->
        <div class="mb-8">
          <div class="flex items-center mb-4">
            <span class="inline-block w-3 h-3 rounded-full bg-primary mr-2"></span>
            <h3 class="text-lg font-semibold text-dark">1. å¤´éƒ¨æ ‡é¢˜è®¾ç½®</h3>
          </div>
          
          <!-- æ ‡é¢˜è¾“å…¥ï¼ˆé»˜è®¤å¡«å……â€œä»Šæ—¥è®¡åˆ’â€ï¼‰ -->
          <div class="mb-6">
            <label for="title-input" class="block text-secondary font-medium mb-2">æ ‡é¢˜æ–‡å­—ï¼ˆå»ºè®®â‰¤8å­—ï¼‰</label>
            <textarea 
              id="title-input" 
              class="w-full h-28 p-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none resize-none transition-all-300"
              placeholder="è¯·è¾“å…¥å¤´éƒ¨æ ‡é¢˜ï¼ˆå¦‚å•†å“åç§°ã€åˆ†ç±»æ ‡ç­¾ï¼‰"
            >ä»Šæ—¥è®¡åˆ’</textarea>
            <div class="text-right text-sm text-gray-400 mt-1">
              <span id="title-char-count">4</span> å­—ç¬¦
            </div>
          </div>
          
          <!-- æ ‡é¢˜å­—ä½“é€‰æ‹©ï¼ˆé»˜è®¤é€‰ä¸­é»‘ä½“ï¼‰ -->
          <div class="mb-6">
            <p class="option-group-title">é€‰æ‹©å­—ä½“</p>
            <select id="title-font" class="border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all-300">
              <option value="arial">Arialï¼ˆçº¤ç»†æ¸…æ™°ï¼‰</option>
              <option value="heiti" selected>é»‘ä½“ï¼ˆç²—å®é†’ç›®ï¼Œé»˜è®¤ï¼‰</option>
              <option value="sourceHan">æ€æºé»‘ä½“ï¼ˆå¹³è¡¡ç¾è§‚ï¼‰</option>
            </select>
          </div>
          
          <!-- æ ‡é¢˜å¤§å°è®¾ç½®ï¼ˆé»˜è®¤28pxï¼Œä¿æŒä¸å˜ï¼‰ -->
          <div class="mb-6">
            <div class="flex justify-between items-center mb-2">
              <label for="title-font-size" class="block text-secondary font-medium">æ–‡å­—å¤§å°ï¼ˆ24px-34pxï¼‰</label>
              <span id="title-font-size-value" class="text-primary font-medium">28px</span>
            </div>
            <input 
              type="range" 
              id="title-font-size" 
              min="24" 
              max="34" 
              value="28" 
              class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"
            >
          </div>
          
          <!-- æ ‡é¢˜é¢œè‰²é€‰æ‹©ï¼ˆé»˜è®¤é€‰ä¸­çº¢è‰²ï¼‰ -->
          <div class="mb-6">
            <p class="option-group-title">æ–‡å­—é¢œè‰²</p>
            <div class="flex space-x-4">
              <label class="cursor-pointer flex items-center">
                <input type="radio" name="title-color" value="#000000" class="sr-only peer">
                <span class="w-8 h-8 rounded-full bg-black border-2 border-transparent peer-checked:border-primary transition-all-300 mr-2"></span>
                <span class="text-dark">çº¯é»‘è‰²</span>
              </label>
              <label class="cursor-pointer flex items-center">
                <input type="radio" name="title-color" value="#FF0000" class="sr-only peer" checked>
                <span class="w-8 h-8 rounded-full bg-red-600 border-2 border-transparent peer-checked:border-primary transition-all-300 mr-2"></span>
                <span class="text-dark">çº¢è‰²ï¼ˆé»˜è®¤ï¼‰</span>
              </label>
            </div>
          </div>
          
          <!-- æ ‡é¢˜å¯¹é½æ–¹å¼ï¼ˆé»˜è®¤å±…ä¸­ï¼Œä¿æŒä¸å˜ï¼‰- ç§»é™¤emojiæ”¹ç”¨æ–‡å­— -->
          <div>
            <p class="option-group-title">å¯¹é½æ–¹å¼</p>
            <div class="flex space-x-4 flex-wrap">
              <label class="cursor-pointer flex items-center">
                <input type="radio" name="title-align" value="left" class="sr-only peer">
                <span class="w-8 h-8 flex items-center justify-center bg-gray-100 border-2 border-transparent peer-checked:border-primary peer-checked:bg-primary/10 rounded transition-all-300 mr-2 align-btn">
                  å·¦
                </span>
                <span class="text-dark">å·¦å¯¹é½</span>
              </label>
              <label class="cursor-pointer flex items-center">
                <input type="radio" name="title-align" value="center" class="sr-only peer" checked>
                <span class="w-8 h-8 flex items-center justify-center bg-gray-100 border-2 border-transparent peer-checked:border-primary peer-checked:bg-primary/10 rounded transition-all-300 mr-2 align-btn">
                  ä¸­
                </span>
                <span class="text-dark">å±…ä¸­ï¼ˆé»˜è®¤ï¼‰</span>
              </label>
              <label class="cursor-pointer flex items-center">
                <input type="radio" name="title-align" value="right" class="sr-only peer">
                <span class="w-8 h-8 flex items-center justify-center bg-gray-100 border-2 border-transparent peer-checked:border-primary peer-checked:bg-primary/10 rounded transition-all-300 mr-2 align-btn">
                  å³
                </span>
                <span class="text-dark">å³å¯¹é½</span>
              </label>
            </div>
          </div>
        </div>
        
        <!-- æ­£æ–‡éƒ¨åˆ†è®¾ç½® -->
        <div>
          <div class="flex items-center mb-4">
            <span class="inline-block w-3 h-3 rounded-full bg-accent mr-2"></span>
            <h3 class="text-lg font-semibold text-dark">2. æ­£æ–‡å†…å®¹è®¾ç½®</h3>
          </div>
          
          <!-- æ­£æ–‡è¾“å…¥ï¼ˆé»˜è®¤å¡«å……4è¡Œæ ·ç¨¿ï¼š9:00ã€æ¨¡æ‹Ÿè€ƒè¯•ã€15:00ã€ä¼‘æ¯ä¸€ä¸‹ï¼‰ -->
          <div class="mb-6">
            <label for="content-input" class="block text-secondary font-medium mb-2">æ­£æ–‡æ–‡å­—ï¼ˆå»ºè®®â‰¤10è¡Œï¼Œæ¯è¡Œâ‰¤6å­—ï¼‰</label>
            <textarea 
              id="content-input" 
              class="w-full h-60 p-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none resize-none transition-all-300"
              placeholder="è¯·è¾“å…¥æ­£æ–‡å†…å®¹ï¼ˆå¦‚ä»·æ ¼ã€è§„æ ¼ã€æè¿°ï¼‰"
            >9:00
æ¨¡æ‹Ÿè€ƒè¯•
15:00
ä¼‘æ¯ä¸€ä¸‹</textarea>
            <div class="text-right text-sm text-gray-400 mt-1">
              <span id="content-char-count">14</span> å­—ç¬¦
            </div>
          </div>
          
          <!-- æ­£æ–‡å­—ä½“é€‰æ‹©ï¼ˆé»˜è®¤Arialï¼‰ -->
          <div class="mb-6">
            <p class="option-group-title">é€‰æ‹©å­—ä½“</p>
            <select id="content-font" class="border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all-300">
              <option value="arial" selected>Arialï¼ˆçº¤ç»†æ¸…æ™°ï¼Œé»˜è®¤ï¼‰</option>
              <option value="heiti">é»‘ä½“ï¼ˆç²—å®é†’ç›®ï¼‰</option>
              <option value="sourceHan">æ€æºé»‘ä½“ï¼ˆå¹³è¡¡ç¾è§‚ï¼‰</option>
            </select>
          </div>
          
          <!-- æ­£æ–‡å¤§å°è®¾ç½®ï¼ˆé»˜è®¤18pxï¼‰ -->
          <div class="mb-6">
            <div class="flex justify-between items-center mb-2">
              <label for="content-font-size" class="block text-secondary font-medium">æ–‡å­—å¤§å°ï¼ˆ16px-28pxï¼‰</label>
              <span id="content-font-size-value" class="text-primary font-medium">18px</span>
            </div>
            <input 
              type="range" 
              id="content-font-size" 
              min="16" 
              max="28" 
              value="18" 
              class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"
            >
          </div>
          
          <!-- æ­£æ–‡é¢œè‰²é€‰æ‹©ï¼ˆé»˜è®¤çº¯é»‘è‰²ï¼‰ -->
          <div class="mb-6">
            <p class="option-group-title">æ–‡å­—é¢œè‰²</p>
            <div class="flex space-x-4">
              <label class="cursor-pointer flex items-center">
                <input type="radio" name="content-color" value="#000000" class="sr-only peer" checked>
                <span class="w-8 h-8 rounded-full bg-black border-2 border-transparent peer-checked:border-primary transition-all-300 mr-2"></span>
                <span class="text-dark">çº¯é»‘è‰²ï¼ˆé»˜è®¤ï¼‰</span>
              </label>
              <label class="cursor-pointer flex items-center">
                <input type="radio" name="content-color" value="#FF0000" class="sr-only peer">
                <span class="w-8 h-8 rounded-full bg-red-600 border-2 border-transparent peer-checked:border-primary transition-all-300 mr-2"></span>
                <span class="text-dark">çº¢è‰²</span>
              </label>
            </div>
          </div>
          
          <!-- æ­£æ–‡å¯¹é½æ–¹å¼ï¼ˆé»˜è®¤å·¦å¯¹é½ï¼‰- ç§»é™¤emojiæ”¹ç”¨æ–‡å­— -->
          <div>
            <p class="option-group-title">å¯¹é½æ–¹å¼</p>
            <div class="flex space-x-4 flex-wrap">
              <label class="cursor-pointer flex items-center">
                <input type="radio" name="content-align" value="left" class="sr-only peer" checked>
                <span class="w-8 h-8 flex items-center justify-center bg-gray-100 border-2 border-transparent peer-checked:border-primary peer-checked:bg-primary/10 rounded transition-all-300 mr-2 align-btn">
                  å·¦
                </span>
                <span class="text-dark">å·¦å¯¹é½ï¼ˆé»˜è®¤ï¼‰</span>
              </label>
              <label class="cursor-pointer flex items-center">
                <input type="radio" name="content-align" value="center" class="sr-only peer">
                <span class="w-8 h-8 flex items-center justify-center bg-gray-100 border-2 border-transparent peer-checked:border-primary peer-checked:bg-primary/10 rounded transition-all-300 mr-2 align-btn">
                  ä¸­
                </span>
                <span class="text-dark">å±…ä¸­</span>
              </label>
              <label class="cursor-pointer flex items-center">
                <input type="radio" name="content-align" value="right" class="sr-only peer">
                <span class="w-8 h-8 flex items-center justify-center bg-gray-100 border-2 border-transparent peer-checked:border-primary peer-checked:bg-primary/10 rounded transition-all-300 mr-2 align-btn">
                  å³
                </span>
                <span class="text-dark">å³å¯¹é½</span>
              </label>
            </div>
          </div>
        </div>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <div class="flex flex-col sm:flex-row gap-4 mt-8">
          <button 
            id="generate-btn" 
            class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all-300 flex items-center justify-center"
          >
            <span class="icon">âœ¨</span> <span class="mr-2">ç”Ÿæˆå›¾ç‰‡</span>
          </button>
          <button 
            id="download-btn" 
            class="flex-1 bg-accent hover:bg-accent/90 text-white font-medium py-3 px-6 rounded-lg transition-all-300 flex items-center justify-center"
            disabled
          >
            <span class="icon">ğŸ“¥</span> <span class="mr-2">ä¸‹è½½å›¾ç‰‡</span>
          </button>
        </div>
        
        <!-- ç§»é™¤æç¤ºä¿¡æ¯ -->
      </div>
      
      <!-- å³ä¾§ï¼šé¢„è§ˆåŒºåŸŸ -->
      <div class="flex flex-col items-center justify-center">
        <h2 class="text-xl md:text-2xl font-semibold text-dark mb-6 self-start">
          å›¾ç‰‡é¢„è§ˆ
        </h2>
        
        <!-- é¢„è§ˆå®¹å™¨ -->
        <div class="preview-container mb-8 relative">
          <div class="image-placeholder" id="preview-click-area">
            <canvas id="canvas" width="152" height="296"></canvas>
            <!-- é¢„è§ˆæç¤ºæ–‡å­— -->
            <div class="preview-tooltip hidden" id="preview-tooltip">ç‚¹å‡»æ”¾å¤§æŸ¥çœ‹ | å¾®ä¿¡é•¿æŒ‰ä¿å­˜</div>
          </div>
        </div>
        
        <!-- ç®€åŒ–é¢„è§ˆæç¤º -->
        <div id="preview-placeholder" class="text-center py-12 text-gray-400">
          <span class="icon text-5xl mb-4 opacity-30">ğŸ–¼ï¸</span>
          <p>ç‚¹å‡»"ç”Ÿæˆå›¾ç‰‡"æŒ‰é’®æŸ¥çœ‹é¢„è§ˆ</p>
        </div>
        
        <div id="preview-success" class="text-center py-4 text-green-600 hidden">
          <span class="icon">âœ…</span> <span class="ml-1">å›¾ç‰‡ç”ŸæˆæˆåŠŸï¼</span>
        </div>
        
        <!-- ç§»é™¤å›¾ç‰‡å°ºå¯¸ä¿¡æ¯åŒºåŸŸ -->
      </div>
    </div>
  </main>

  <!-- æ”¾å¤§é¢„è§ˆæ¨¡æ€æ¡† -->
  <div class="modal-overlay" id="image-modal">
    <div class="modal-content">
      <img src="" alt="æ”¾å¤§é¢„è§ˆå›¾" class="modal-image" id="modal-image">
      <button class="close-modal" id="close-modal">Ã—</button>
      <div class="wechat-tip">å¾®ä¿¡é•¿æŒ‰å›¾ç‰‡å¯ä¿å­˜</div>
    </div>
  </div>

  <!-- é¡µè„š -->
  <footer class="bg-dark text-white py-8">
    <div class="container mx-auto px-4 text-center">
      <p class="text-gray-400">Â© 2025 é»˜æ ¼ç ”ä¹ ç¤¾å¼€æº</p>
    </div>
  </footer>

  <!-- JavaScript é€»è¾‘ - æ–°å¢å¾®ä¿¡å‹å¥½å‹æ”¾å¤§é¢„è§ˆåŠŸèƒ½ -->
  <script>
    // æµè§ˆå™¨å…¼å®¹æ€§æ£€æµ‹
    function checkBrowserCompatibility() {
      const canvas = document.createElement('canvas');
      const isCompatible = !!(
        canvas.getContext && 
        canvas.getContext('2d') && 
        typeof Promise !== 'undefined' && 
        typeof Array.prototype.forEach !== 'undefined'
      );
      
      if (!isCompatible) {
        document.getElementById('compatibility-alert').classList.remove('hidden');
      }
      return isCompatible;
    }
    
    const isBrowserCompatible = checkBrowserCompatibility();
    
    // è·å–DOMå…ƒç´ ï¼ˆæ ‡é¢˜ç›¸å…³ï¼‰
    const titleInput = document.getElementById('title-input');
    const titleFont = document.getElementById('title-font');
    const titleFontSize = document.getElementById('title-font-size');
    const titleFontSizeValue = document.getElementById('title-font-size-value');
    const titleColorRadios = document.querySelectorAll('input[name="title-color"]');
    const titleAlignRadios = document.querySelectorAll('input[name="title-align"]');
    const titleCharCount = document.getElementById('title-char-count');
    
    // è·å–DOMå…ƒç´ ï¼ˆæ­£æ–‡ç›¸å…³ï¼‰
    const contentInput = document.getElementById('content-input');
    const contentFont = document.getElementById('content-font');
    const contentFontSize = document.getElementById('content-font-size');
    const contentFontSizeValue = document.getElementById('content-font-size-value');
    const contentColorRadios = document.querySelectorAll('input[name="content-color"]');
    const contentAlignRadios = document.querySelectorAll('input[name="content-align"]');
    const contentCharCount = document.getElementById('content-char-count');
    
    // å…¬å…±å…ƒç´ 
    const generateBtn = document.getElementById('generate-btn');
    const downloadBtn = document.getElementById('download-btn');
    const canvas = document.getElementById('canvas');
    const ctx = isBrowserCompatible ? canvas.getContext('2d') : null;
    const previewPlaceholder = document.getElementById('preview-placeholder');
    const previewSuccess = document.getElementById('preview-success');
    const previewClickArea = document.getElementById('preview-click-area');
    const previewTooltip = document.getElementById('preview-tooltip');
    
    // æ”¾å¤§é¢„è§ˆç›¸å…³å…ƒç´ 
    const imageModal = document.getElementById('image-modal');
    const modalImage = document.getElementById('modal-image');
    const closeModal = document.getElementById('close-modal');
    
    // å­—ä½“æ˜ å°„è¡¨ï¼ˆå…³é”®ï¼šå°†é€‰æ‹©å€¼è½¬ä¸ºå®é™…å­—ä½“å®¶æ—ï¼‰
    const fontMap = {
      arial: 'Arial, sans-serif',
      heiti: 'Microsoft YaHei, Heiti SC, é»‘ä½“, sans-serif',
      sourceHan: 'Source Han Sans CN, æ€æºé»‘ä½“, sans-serif'
    };
    
    // åˆå§‹åŒ–ç”»å¸ƒï¼ˆçº¯ç™½èƒŒæ™¯ + æŠ—é”¯é½¿ä¼˜åŒ–ï¼‰
    function initCanvas() {
      if (!ctx) return;
      
      // å…³é”®ä¼˜åŒ–1ï¼šè®¾ç½®Canvasæ¸²æŸ“è´¨é‡
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // å…³é”®ä¼˜åŒ–2ï¼šç¦ç”¨æŠ—é”¯é½¿ï¼ˆè®©æ–‡å­—è¾¹ç¼˜æ›´é”åˆ©ï¼‰
      ctx.imageSmoothingEnabled = false;
      ctx.mozImageSmoothingEnabled = false;
      ctx.webkitImageSmoothingEnabled = false;
      ctx.msImageSmoothingEnabled = false;
      
      ctx.save();
    }
    
    // é¡µé¢åŠ è½½åˆå§‹åŒ–ï¼ˆæ›´æ–°é»˜è®¤é…ç½®çš„å­—ç¬¦è®¡æ•°ï¼‰
    window.addEventListener('load', () => {
      if (isBrowserCompatible) {
        initCanvas();
        // åˆå§‹åŒ–å­—ç¬¦è®¡æ•°ï¼ˆåŒ¹é…é»˜è®¤å¡«å……å†…å®¹ï¼šæ ‡é¢˜4å­—ç¬¦ï¼Œæ­£æ–‡14å­—ç¬¦ï¼‰
        titleCharCount.textContent = titleInput.value.length;
        contentCharCount.textContent = contentInput.value.length;
      } else {
        alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒCanvasåŠŸèƒ½ï¼Œæ— æ³•ç”Ÿæˆå›¾ç‰‡ï¼Œè¯·å‡çº§æµè§ˆå™¨ï¼');
      }
      
      // åˆå§‹åŒ–æ¨¡æ€æ¡†äº‹ä»¶
      initModalEvents();
    });
    
    // åˆå§‹åŒ–æ”¾å¤§é¢„è§ˆæ¨¡æ€æ¡†äº‹ä»¶
    function initModalEvents() {
      // ç‚¹å‡»é¢„è§ˆå›¾æ‰“å¼€æ¨¡æ€æ¡†
      previewClickArea.addEventListener('click', () => {
        if (downloadBtn.disabled) return; // æœªç”Ÿæˆå›¾ç‰‡æ—¶ä¸è§¦å‘
        
        // è·å–Canvasçš„dataURLå¹¶è®¾ç½®åˆ°æ¨¡æ€æ¡†å›¾ç‰‡
        const dataURL = canvas.toDataURL('image/png', 1.0);
        modalImage.src = dataURL;
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        imageModal.classList.add('active');
        // ç¦æ­¢èƒŒæ™¯æ»šåŠ¨
        document.body.style.overflow = 'hidden';
      });
      
      // å…³é—­æ¨¡æ€æ¡†
      closeModal.addEventListener('click', closeModalHandler);
      
      // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
      imageModal.addEventListener('click', (e) => {
        if (e.target === imageModal) {
          closeModalHandler();
        }
      });
      
      // é”®ç›˜ESCå…³é—­
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && imageModal.classList.contains('active')) {
          closeModalHandler();
        }
      });
      
      // ç”Ÿæˆå›¾ç‰‡åæ˜¾ç¤ºæç¤ºæ–‡å­—
      generateBtn.addEventListener('click', () => {
        setTimeout(() => {
          if (!downloadBtn.disabled) {
            previewTooltip.classList.remove('hidden');
          }
        }, 200);
      });
    }
    
    // å…³é—­æ¨¡æ€æ¡†å¤„ç†å‡½æ•°
    function closeModalHandler() {
      imageModal.classList.remove('active');
      document.body.style.overflow = '';
      // å»¶è¿Ÿæ¸…ç©ºå›¾ç‰‡srcï¼Œé¿å…é—ªçƒ
      setTimeout(() => {
        modalImage.src = '';
      }, 300);
    }
    
    // æ ‡é¢˜å­—ç¬¦è®¡æ•°
    titleInput.addEventListener('input', () => {
      titleCharCount.textContent = titleInput.value.length;
      // é™åˆ¶æ ‡é¢˜æœ€å¤§å­—ç¬¦æ•°
      if (titleInput.value.length > 8) {
        titleInput.value = titleInput.value.slice(0, 8);
        titleCharCount.textContent = 8;
      }
    });
    
    // æ­£æ–‡å­—ç¬¦è®¡æ•°
    contentInput.addEventListener('input', () => {
      contentCharCount.textContent = contentInput.value.length;
    });
    
    // æ ‡é¢˜å­—å·æ»‘å—æ›´æ–°
    titleFontSize.addEventListener('input', () => {
      titleFontSizeValue.textContent = `${titleFontSize.value}px`;
    });
    
    // æ­£æ–‡å­—å·æ»‘å—æ›´æ–°ï¼ˆé»˜è®¤å€¼18pxï¼‰
    contentFontSize.addEventListener('input', () => {
      contentFontSizeValue.textContent = `${contentFontSize.value}px`;
    });
    
    // è·å–æ ‡é¢˜é…ç½®ï¼ˆé»˜è®¤çº¢è‰²é»‘ä½“28pxå±…ä¸­ï¼‰
    function getTitleConfig() {
      let color = '#FF0000'; // é»˜è®¤çº¢è‰²
      titleColorRadios.forEach(radio => radio.checked && (color = radio.value));
      
      let align = 'center'; // é»˜è®¤å±…ä¸­
      titleAlignRadios.forEach(radio => radio.checked && (align = radio.value));
      
      return {
        text: titleInput.value.trim(),
        font: fontMap[titleFont.value], // é»˜è®¤é»‘ä½“
        fontSize: parseInt(titleFontSize.value), // é»˜è®¤28px
        color: color,
        align: align
      };
    }
    
    // è·å–æ­£æ–‡é…ç½®ï¼ˆé»˜è®¤é»‘è‰²Arial18pxå·¦å¯¹é½ï¼‰
    function getContentConfig() {
      let color = '#000000'; // é»˜è®¤é»‘è‰²
      contentColorRadios.forEach(radio => radio.checked && (color = radio.value));
      
      let align = 'left'; // é»˜è®¤å·¦å¯¹é½
      contentAlignRadios.forEach(radio => radio.checked && (align = radio.value));
      
      return {
        text: contentInput.value.trim(),
        font: fontMap[contentFont.value], // é»˜è®¤Arial
        fontSize: parseInt(contentFontSize.value), // é»˜è®¤18px
        color: color,
        align: align
      };
    }
    
    // ç»˜åˆ¶å•è¡Œæ–‡å­—ï¼ˆä¼˜åŒ–æ¸…æ™°åº¦ï¼‰
    function drawSingleLineText(config, yPosition) {
      if (!ctx || !config.text) return;
      
      // å…³é”®ä¼˜åŒ–3ï¼šä½¿ç”¨ç²¾ç¡®çš„å­—ä½“å¤§å°ï¼Œé¿å…å°æ•°åƒç´ å¯¼è‡´æ¨¡ç³Š
      const exactFontSize = Math.round(config.fontSize);
      ctx.font = `${exactFontSize}px ${config.font}`;
      ctx.textAlign = config.align;
      // å…³é”®ä¼˜åŒ–4ï¼šä½¿ç”¨topå¯¹é½æ–¹å¼ï¼Œé¿å…å‚ç›´å±…ä¸­å¯¼è‡´çš„äºšåƒç´ åç§»
      ctx.textBaseline = 'top';
      ctx.fillStyle = config.color;
      
      const canvasWidth = canvas.width;
      const padding = 15;
      let startX;
      
      switch(config.align) {
        case 'left': startX = padding; break;
        case 'right': startX = canvasWidth - padding; break;
        default: startX = canvasWidth / 2;
      }
      
      // å…³é”®ä¼˜åŒ–5ï¼šç¡®ä¿ç»˜åˆ¶ä½ç½®æ˜¯æ•´æ•°åæ ‡ï¼Œé¿å…äºšåƒç´ æ¸²æŸ“
      const x = Math.round(startX);
      const y = Math.round(yPosition);
      
      // å¤„ç†æ ‡é¢˜è¶…é•¿æˆªå–
      let displayText = config.text;
      const textWidth = ctx.measureText(displayText).width;
      if (textWidth > canvasWidth - 2 * padding) {
        displayText = displayText.slice(0, 6) + '...';
      }
      
      // å…³é”®ä¼˜åŒ–6ï¼šç»˜åˆ¶ä¸¤æ¬¡ï¼ˆè½»å¾®åç§»ï¼‰å¢å¼ºè¾¹ç¼˜é”åº¦
      ctx.fillText(displayText, x, y);
      ctx.fillText(displayText, x + 0.5, y);
    }
    
    // ç»˜åˆ¶å¤šè¡Œæ­£æ–‡ï¼ˆä¼˜åŒ–æ¸…æ™°åº¦ï¼‰
    function drawMultiLineText(config, startY) {
      if (!ctx || !config.text) return;
      
      // å…³é”®ä¼˜åŒ–3ï¼šä½¿ç”¨ç²¾ç¡®çš„å­—ä½“å¤§å°
      const exactFontSize = Math.round(config.fontSize);
      ctx.font = `${exactFontSize}px ${config.font}`;
      ctx.textAlign = config.align;
      ctx.textBaseline = 'top'; // ä¼˜åŒ–å‚ç›´å¯¹é½
      ctx.fillStyle = config.color;
      
      const canvasWidth = canvas.width;
      const padding = 15;
      const maxWidth = canvasWidth - 2 * padding;
      // è¡Œé«˜ä¼˜åŒ–ï¼š1.3å€å­—å·ï¼Œä¿æŒæ•´æ•°è¡Œé«˜
      const lineHeight = Math.round(exactFontSize * 1.3);
      
      // æ¢è¡Œå¤„ç†ï¼ˆé€‚é…4è¡Œç‹¬ç«‹æ–‡æœ¬ï¼‰
      const rawLines = config.text.split(/\r?\n/);
      const lines = [];
      rawLines.forEach(line => {
        if (!line.trim()) {
          lines.push('');
          return;
        }
        let currentLine = '';
        const words = line.split(/\s+/);
        words.forEach(word => {
          const testLine = currentLine ? `${currentLine} ${word}` : word;
          if (ctx.measureText(testLine).width <= maxWidth || !currentLine) {
            currentLine = testLine;
          } else {
            lines.push(currentLine);
            currentLine = word;
          }
        });
        currentLine && lines.push(currentLine);
      });
      
      // æœ€å¤§10è¡Œé™åˆ¶
      const maxLines = 10;
      const finalLines = lines.slice(0, maxLines);
      if (lines.length > maxLines) {
        finalLines[maxLines - 1] = finalLines[maxLines - 1].slice(0, 4) + '...';
      }
      
      // è®¡ç®—æ¯è¡Œä½ç½®ï¼ˆç¡®ä¿æ•´æ•°åæ ‡ï¼‰
      finalLines.forEach((line, index) => {
        const y = Math.round(startY + (index * lineHeight));
        // é˜²æ­¢æ–‡å­—è¶…å‡ºç”»å¸ƒåº•éƒ¨
        if (y + exactFontSize > canvas.height - padding) return;
        
        let startX;
        switch(config.align) {
          case 'left': startX = padding; break;
          case 'right': startX = canvasWidth - padding; break;
          default: startX = canvasWidth / 2;
        }
        const x = Math.round(startX);
        
        // å…³é”®ä¼˜åŒ–6ï¼šåŒé‡ç»˜åˆ¶å¢å¼ºé”åº¦
        line.trim() && ctx.fillText(line, x, y);
        line.trim() && ctx.fillText(line, x + 0.5, y);
      });
    }
    
    // æ ¸å¿ƒç”Ÿæˆå‡½æ•°ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
    function generateImage() {
      if (!isBrowserCompatible) return;
      
      initCanvas();
      
      const titleConfig = getTitleConfig();
      const contentConfig = getContentConfig();
      
      // æ ‡é¢˜é é¡¶å¸ƒå±€ï¼ˆæ•´æ•°åæ ‡ï¼‰
      const titleY = Math.round(15 + (titleConfig.fontSize / 2));
      // æ­£æ–‡èµ·å§‹ä½ç½®ï¼ˆæ•´æ•°åæ ‡ï¼‰
      const contentStartY = Math.round(titleY + titleConfig.fontSize + 10);
      
      // ç»˜åˆ¶æ ‡é¢˜
      drawSingleLineText(titleConfig, titleY);
      
      // ç»˜åˆ¶æ­£æ–‡
      drawMultiLineText(contentConfig, contentStartY);
      
      // æ›´æ–°UIçŠ¶æ€
      previewPlaceholder.classList.add('hidden');
      previewSuccess.classList.remove('hidden');
      downloadBtn.disabled = false;
      previewTooltip.classList.remove('hidden'); // æ˜¾ç¤ºç‚¹å‡»æç¤º
    }
    
    // ç”ŸæˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
    generateBtn.addEventListener('click', () => {
      const titleText = titleInput.value.trim();
      const contentText = contentInput.value.trim();
      
      if (!titleText && !contentText) {
        alert('è¯·è‡³å°‘è¾“å…¥æ ‡é¢˜æˆ–æ­£æ–‡å†…å®¹');
        return;
      }
      
      generateBtn.classList.add('animate-pulse');
      setTimeout(() => {
        generateImage();
        generateBtn.classList.remove('animate-pulse');
      }, 150);
    });
    
    // ä¸‹è½½æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
    downloadBtn.addEventListener('click', () => {
      if (!isBrowserCompatible) {
        alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒä¸‹è½½åŠŸèƒ½ï¼Œè¯·å‡çº§ï¼');
        return;
      }
      
      try {
        const link = document.createElement('a');
        const timestamp = new Date().getTime();
        link.download = `é»˜æ ¼å°å±åŠ©æ‰‹_${timestamp}.png`;
        document.body.appendChild(link);
        
        // å…³é”®ä¼˜åŒ–7ï¼šä½¿ç”¨é«˜è´¨é‡PNGå¯¼å‡º
        const dataURL = canvas.toDataURL('image/png', 1.0);
        link.href = dataURL;
        
        // Safariå…¼å®¹å¤„ç†
        if (navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome')) {
          const blob = dataURLToBlob(dataURL);
          const url = URL.createObjectURL(blob);
          link.href = url;
          link.click();
          URL.revokeObjectURL(url);
        } else {
          link.click();
        }
        
        document.body.removeChild(link);
        alert('å›¾ç‰‡ä¸‹è½½æˆåŠŸï¼å¾®ä¿¡ç”¨æˆ·ä¹Ÿå¯ç‚¹å‡»é¢„è§ˆå›¾é•¿æŒ‰ä¿å­˜');
      } catch (error) {
        console.error('ä¸‹è½½å¤±è´¥ï¼š', error);
        alert('å›¾ç‰‡ä¸‹è½½å¤±è´¥ï¼Œè¯·ç‚¹å‡»é¢„è§ˆå›¾åé•¿æŒ‰ä¿å­˜ï¼ˆå¾®ä¿¡é€‚ç”¨ï¼‰ï¼');
      }
    });
    
    // dataURLè½¬Blobï¼ˆå…¼å®¹Safariï¼‰
    function dataURLToBlob(dataURL) {
      const arr = dataURL.split(',');
      const mime = arr[0].match(/:(.*?);/)[1];
      const bstr = atob(arr[1]);
      let n = bstr.length;
      const u8arr = new Uint8Array(n);
      while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
      }
      return new Blob([u8arr], { type: mime });
    }
    
    // çª—å£å¤§å°å˜åŒ–é‡æ–°ç»˜åˆ¶
    window.addEventListener('resize', () => {
      if (!isBrowserCompatible) return;
      
      const titleText = titleInput.value.trim();
      const contentText = contentInput.value.trim();
      
      if (titleText || contentText) {
        clearTimeout(window.resizeTimer);
        window.resizeTimer = setTimeout(generateImage, 200);
      }
    });
  </script>
</body>
</html>
